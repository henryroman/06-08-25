---
import Button from '../atomic/Button.astro';
import Input from '../atomic/Input.astro';
import business from '../../data/business.json';
---
<section id="contact" class="contact-section py-20 bg-white">
  <div class="container mx-auto px-4">
    <div class="grid lg:grid-cols-2 gap-12">
      <div>
        <h2 class="text-3xl font-bold text-gray-900 mb-6">Get In Touch</h2>
        <p class="text-lg text-gray-600 mb-8">
          For questions or appointments, contact us below.
        </p>
        {business.address && (
          <div class="flex items-center mb-4">
            <span class="mr-2">🏠</span>
            <p>{business.address}</p>
          </div>
        )}
        {business.phone && (
          <div class="flex items-center mb-4">
            <span class="mr-2">📞</span>
            <p>{business.phone}</p>
          </div>
        )}
        {business.email && (
          <div class="flex items-center mb-4">
            <span class="mr-2">📧</span>
            <p>{business.email}</p>
          </div>
        )}
      </div>
      <div>
        <form id="contact-form" class="space-y-6">
          <div class="grid md:grid-cols-2 gap-4">
            <Input type="text" name="name" placeholder="Your Name" required />
            <Input type="email" name="email" placeholder="Your Email" required />
          </div>
          <Input type="tel" name="phone" placeholder="Your Phone" />
          <textarea
            name="message"
            rows="4"
            placeholder="Your Message"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg"
          />
          <Button type="submit" variant="primary" size="lg" class="w-full">
            Send Message
          </Button>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
  // Cast to HTMLFormElement so TS knows about reset() and elements
  const form = document.getElementById('contact-form') as HTMLFormElement | null;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form));
    try {
      const res = await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });
      if (res.ok) {
        alert('Message sent successfully!');
        form.reset();
      } else {
        const err = await res.json();
        alert('Error: ' + err.message);
      }
    } catch {
      alert('Network error');
    }
  });
</script>
